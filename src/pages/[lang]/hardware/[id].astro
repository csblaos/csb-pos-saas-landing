---
import Base from '../../../layouts/Base.astro';
import Navbar from '../../../components/sections/Navbar.astro';
import Footer from '../../../components/sections/Footer.astro';
import { hardwareProducts } from '../../../data/hardware';
import { languages } from '../../../lib/lang';
import { buildWhatsAppLink, storeSettings } from '../../../data/store';
import { buildHardwareWhatsappMessage, fromLang, hardwareDetailCopy } from '../../../data/localizedCopy';
import { Check, Star, ArrowLeft, Share2 } from 'lucide-react';
import ProductShare from '../../../components/islands/ProductShare';

export async function getStaticPaths() {
  const paths = [];
  Object.keys(languages).forEach((lang) => {
    hardwareProducts.forEach((product) => {
      paths.push({
        params: { lang, id: product.id },
        props: { product },
      });
    });
  });
  return paths;
}

const { lang } = Astro.params;
const { product } = Astro.props;

const currentUrl = Astro.url.href;
const whatsappMessage = buildHardwareWhatsappMessage(lang, product.name[lang], product.priceLak, currentUrl);
const whatsappLink = buildWhatsAppLink(storeSettings.whatsapp.productSales, whatsappMessage);

const copy = fromLang(hardwareDetailCopy, lang);

// Dynamic OG Image
const ogImage = new URL(`/open-graph/${lang}/hardware/${product.id}.png?v=2`, Astro.url);
---

<Base 
  title={`${product.name[lang]} - AstroPOS Hardware`}
  description={product.description[lang]}
  image={ogImage.href}
>
  <Navbar />

  <main class="py-8 md:py-12 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Breadcrumb / Back -->
      <a href={`/${lang}/hardware`} class="inline-flex items-center gap-2 font-bold text-gray-700 hover:text-black mb-8 transition-colors">
        <ArrowLeft size={20} /> {copy.back}
      </a>

      <div class="grid md:grid-cols-2 gap-12 lg:gap-20">
        <!-- Left: Image -->
        <div class="relative">
            <div class="aspect-square bg-white border-1 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] rounded-lg overflow-hidden relative">
                {product.badge && (
                    <div class="absolute top-4 right-4 bg-yellow-400 border-1 border-black px-4 py-1 font-black text-sm uppercase shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] z-10">
                        {product.badge[lang]}
                    </div>
                )}
                <img 
                    src={product.image} 
                    alt={product.name[lang]}
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-700"
                    style="view-transition-name: product-image;"
                />
            </div>
        </div>

        <!-- Right: Content -->
        <div class="flex flex-col">
            <h1 class="text-4xl md:text-5xl font-black uppercase leading-tight mb-2">
                {product.name[lang]}
            </h1>
            
            <div class="flex items-center gap-2 text-yellow-500 mb-6 font-bold text-lg">
                <div class="flex"><Star fill="currentColor" /><Star fill="currentColor" /><Star fill="currentColor" /><Star fill="currentColor" /><Star fill="currentColor" /></div>
                <span class="text-black text-sm">{copy.rating}</span>
            </div>

            <div class="text-3xl font-black font-mono mb-8 bg-lime-100 inline-block px-4 py-2 border-2 border-black -rotate-1 self-start">
               ₭{product.priceLak.toLocaleString()}
            </div>

            <p class="text-xl text-gray-600 font-medium mb-8 leading-relaxed">
                {product.description[lang]}
            </p>

            <!-- Specs -->
            <div class="mb-8 p-6 bg-gray-50 border-1 border-black/50 rounded-lg">
                <h3 class="font-black uppercase mb-4 text-lg border-b-1 border-black/50 pb-2">{copy.specs}</h3>
                <ul class="space-y-3">
                    {product.specs.map(spec => (
                        <li class="flex items-center gap-3 font-bold text-gray-700">
                             <div class="w-6 h-6 rounded-full bg-lime-400 border-2 border-black flex items-center justify-center shrink-0">
                                <Check size={14} strokeWidth={4} />
                             </div>
                             {spec}
                        </li>
                    ))}
                </ul>
            </div>

            <!-- Action -->
            <div class="mt-auto flex flex-col gap-4">
                <a 
                    href={whatsappLink}
                    target="_blank"
                    class="w-full bg-lime-400 hover:bg-lime-300 text-black border-1 border-black font-black text-xl py-4 flex items-center justify-center gap-3 shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:translate-y-1 hover:shadow-[1px_1px_0px_0px_rgba(0,0,0,1)] transition-all uppercase"
                >
                    <Share2 size={24} /> {copy.buy}
                </a>
                <p class="text-center text-xs font-bold text-gray-700 uppercase tracking-widest">
                    {copy.trustLine}
                </p>

                <div class="border-1 border-black/50 bg-white p-4 rounded-md">
                    <p class="text-sm font-black uppercase text-black">{copy.warrantyTitle}</p>
                    <ul class="mt-2 space-y-1 text-xs md:text-sm font-semibold text-gray-700">
                        <li>• {copy.warrantyPoint1}</li>
                        <li>• {copy.warrantyPoint2}</li>
                        <li>• {copy.warrantyPoint3}</li>
                    </ul>
                    <a
                        href={`/${lang}/help`}
                        class="mt-3 inline-flex items-center font-black text-xs uppercase text-black border-b border-black hover:text-lime-700 transition-colors"
                    >
                        {copy.warrantyTerms}
                    </a>
                </div>

                <ProductShare 
                    client:idle
                    url={currentUrl} 
                    title={product.name[lang]} 
                    translations={{
                        share: copy.shareTitle,
                        copy: copy.shareCopy,
                        copied: copy.shareCopied
                    }} 
                />
            </div>
        </div>
      </div>

    </div>
  </main>

  <Footer />
</Base>
