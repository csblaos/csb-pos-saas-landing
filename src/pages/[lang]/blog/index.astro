---
import Base from '../../../layouts/Base.astro';
import Navbar from '../../../components/sections/Navbar.astro';
import Footer from '../../../components/sections/Footer.astro';
import BlogIndexContent from '../../../components/sections/BlogIndexContent.astro';
import { getCollection } from 'astro:content';
import { getLangFromUrl, languages } from '../../../lib/lang';
import { getTotalPages, paginateItems } from '../../../lib/blog';

export async function getStaticPaths() {
  return Object.keys(languages).map(lang => ({ params: { lang } }));
}

const lang = getLangFromUrl(Astro.url);
const allNews = await getCollection('news');
const sortedNews = allNews.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
const currentPage = 1;
const totalPages = getTotalPages(sortedNews.length);
const pagePosts = paginateItems(sortedNews, currentPage);
---

<Base seoKey="blog">
  <Navbar />
  <BlogIndexContent lang={lang} posts={pagePosts} currentPage={currentPage} totalPages={totalPages} />
  <Footer />
</Base>
