---
import LanguageToggle from '../islands/LanguageToggle';
import MobileMenu from '../islands/MobileMenu';
import Button from '../common/Button.astro';
import { getLangFromUrl } from '../../lib/lang';
import { t } from '../../data/i18n';

const lang = getLangFromUrl(Astro.url);

function normalizePath(path: string) {
  if (!path) return '/';
  const normalized = path.replace(/\/+$/, '');
  return normalized || '/';
}

function isPathActive(currentPath: string, targetPath: string, exact = false) {
  const current = normalizePath(currentPath);
  const target = normalizePath(targetPath);

  if (exact) return current === target;
  return current === target || current.startsWith(`${target}/`);
}
---

<nav class="sticky top-0 z-[100] w-full border-b-2 border-[var(--color-border)] bg-[var(--color-bg-card)]/80 backdrop-blur-md transition-colors duration-300">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full h-16 flex items-center justify-between">
    <a href={`/${lang}/`} class="text-2xl font-black italic tracking-tighter flex items-center gap-2 text-[var(--color-text)]">
      <div class="w-8 h-8 bg-lime-400 border-2 border-[var(--color-border)] shadow-[2px_2px_0px_0px_var(--color-shadow)]"></div>
      Astro<span class="text-lime-600">POS</span>
    </a>

    <div class="hidden md:flex items-center gap-8 font-semibold text-md text-[var(--color-text)]">
      {
        [
          { href: `/${lang}/`, label: t('nav.home', lang), exact: true },
          { href: `/${lang}/packages`, label: t('nav.packages', lang) },
          { href: `/${lang}/hardware`, label: t('nav.hardware', lang) },
          { href: `/${lang}/solutions`, label: t('nav.solutions', lang) },
          { href: `/${lang}/blog`, label: t('nav.blog', lang) },
        ].map((link) => {
          const isActive = isPathActive(Astro.url.pathname, link.href, link.exact);
            
          return (
            <a 
              href={link.href} 
              class={`
                px-3 py-1 transition-all duration-200 border-1 
                ${isActive 
                  ? 'bg-lime-400 text-black border-black shadow-[2px_2px_0px_0px_black] -translate-y-[2px]' 
                  : 'border-transparent hover:border-black/20 hover:bg-gray-100 hover:-translate-y-[1px]'
                }
              `}
            >
              {link.label}
            </a>
          );
        })
      }
    </div>

    <div class="flex items-center gap-3">
      {/* Mobile: Language Toggle & Menu */}
      <LanguageToggle client:load />

      <div class="hidden sm:flex items-center gap-3">
        <a 
          href={`/${lang}/demo`} 
          class="inline-flex items-center gap-1.5 text-sm font-semibold px-2 py-2 bg-white border-1 border-black shadow-[2px_2px_0px_0px_black] hover:shadow-[1px_1px_0px_0px_black] hover:translate-x-[2px] hover:translate-y-[2px] active:shadow-none active:translate-x-[3px] active:translate-y-[3px] transition-all duration-150 text-black"
        >
          â–¶ {t('nav.demo', lang)}
        </a>
      </div>
      
      {/* Mobile Menu */}
      <MobileMenu lang={lang as any} client:load />
    </div>
  </div>
</nav>
